<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - MatchApp</title>
    <link rel="stylesheet" th:href="@{/css/auth.css}">
</head>
<body>

<div class="auth-container">
    <div class="auth-header">
        <h1>–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</h1>
    </div>

    <div th:if="${success}" class="success-message" th:text="${success}"></div>

    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <form method="post" th:action="@{/auth/registration}" th:object="${user}" enctype="multipart/form-data">
        <div th:if="${#fields.hasErrors('*')}" class="alert alert-error">
            –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ
        </div>
        <div class="form-group">
            <label class="form-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –ø—Ä–æ—Ñ–∏–ª—è</label>

            <div class="upload-area" onclick="document.getElementById('profilePhoto').click()">
                <p>üì∑ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</p>
                <p class="text-muted">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: JPG, PNG (–¥–æ 5MB)</p>
            </div>

            <input type="file" id="profilePhoto" th:field="*{profilePhoto}"
                   accept="image/*" style="display: none;" onchange="previewProfilePhoto(this)">

            <!-- –ü—Ä–µ–≤—å—é –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ -->
            <img id="profilePhotoPreview" class="photo-preview" alt="Preview" style="display: none;">

            <span th:if="${#fields.hasErrors('profilePhoto')}" th:errors="*{profilePhoto}" class="error-message"></span>
        </div>
        <div class="form-group">
            <label class="form-label" for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *</label>
            <input type="text" id="username" th:field="*{username}" class="form-control"
                   placeholder="–í–∞—à–µ –∏–º—è">
            <span th:if="${#fields.hasErrors('username')}" th:errors="*{username}" class="error-message"></span>
        </div>

        <div class="form-group">
            <label class="form-label" for="email">Email *</label>
            <input type="email" id="email" th:field="*{email}" class="form-control"
                   placeholder="your@email.com">
            <span th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="error-message"></span>
        </div>

        <div class="form-group">
            <label class="form-label" for="password">–ü–∞—Ä–æ–ª—å *</label>
            <input type="password" id="password" th:field="*{password}" class="form-control"
                   placeholder="–ù–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤">
            <span th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="error-message"></span>
        </div>

        <div class="form-group">
            <label class="form-label" for="dateOfBirth">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
            <input type="date" id="dateOfBirth" th:field="*{dateOfBirth}" class="form-control">
            <span th:if="${#fields.hasErrors('dateOfBirth')}" th:errors="*{dateOfBirth}" class="error-message"></span>
        </div>

        <div class="form-group">
            <label class="form-label" for="gender">–ü–æ–ª *</label>
            <select id="gender" th:field="*{gender}" class="form-control">
                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª</option>
                <option th:each="gender : ${genders}"
                        th:value="${gender}"
                        th:text="${gender.name()}">
                </option>
            </select>
            <span th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}" class="error-message"></span>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="form-label" for="country">–°—Ç—Ä–∞–Ω–∞ *</label>
                <input type="text" id="country" th:field="*{country}" class="form-control"
                       placeholder="–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è">
                <span th:if="${#fields.hasErrors('country')}" th:errors="*{country}" class="error-message"></span>
            </div>

            <div class="form-group">
                <label class="form-label" for="city">–ì–æ—Ä–æ–¥ *</label>
                <input type="text" id="city" th:field="*{city}" class="form-control"
                       placeholder="–ì–æ—Ä–æ–¥ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è">
                <span th:if="${#fields.hasErrors('city')}" th:errors="*{city}" class="error-message"></span>
            </div>
        </div>

        <button type="submit" class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>

    <div class="auth-switch">
        –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a th:href="@{/auth/login}">–í–æ–π–¥–∏—Ç–µ</a>
    </div>
</div>
</body>
</html>
<script>
    function previewProfilePhoto(input) {
        const preview = document.getElementById('profilePhotoPreview');
        const file = input.files[0];

        if (file) {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                input.value = '';
                preview.style.display = 'none';
                return;
            }

            // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞. –†–∞–∑—Ä–µ—à–µ–Ω—ã: JPG, PNG, GIF, WebP');
                input.value = '';
                preview.style.display = 'none';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
        } else {
            preview.style.display = 'none';
        }
    }

    // Drag and drop –¥–ª—è —Ñ–æ—Ç–æ
    const uploadArea = document.querySelector('.upload-area');
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight() {
        uploadArea.style.borderColor = '#4a90e2';
        uploadArea.style.backgroundColor = '#f0f8ff';
    }

    function unhighlight() {
        uploadArea.style.borderColor = '#ccc';
        uploadArea.style.backgroundColor = '';
    }

    uploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        document.getElementById('profilePhoto').files = files;
        previewProfilePhoto(document.getElementById('profilePhoto'));
    }
</script>