<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è - MatchApp</title>
    <link rel="stylesheet" th:href="@{/css/auth.css}">
    <script th:src="@{/js/registration.js}" defer></script>
    <style>
        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #4a90e2;
        }

        .profile-info h1 {
            margin: 0;
            color: #333;
        }

        .profile-stats {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4a90e2;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .tab-navigation {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            border-bottom-color: #4a90e2;
            color: #4a90e2;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .photo-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .photo-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .photo-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            padding: 8px;
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .photo-action-btn {
            background: rgba(255,255,255,0.9);
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .primary-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #4a90e2;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>

<div class="auth-container">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->


    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–∞–±–∞–º -->
    <div class="tab-navigation">
        <button class="tab-button active" onclick="showTab('edit-tab')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        <button class="tab-button" onclick="showTab('photos-tab')">üì∑ –ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</button>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div th:if="${success}" class="success-message" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <!-- –¢–∞–± —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="edit-tab" class="tab-content active">
        <form th:action="@{/profile/update}" method="post" th:object="${profileUpdateDto}">
            <div th:if="${#fields.hasErrors('*')}" class="alert alert-error">
                –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–µ
            </div>

            <input type="hidden" id="latitude" name="latitude" th:field="*{latitude}">
            <input type="hidden" id="longitude" name="longitude" th:field="*{longitude}">

            <!-- –°–µ–∫—Ü–∏—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ -->
            <div class="location-section">
                <h3>üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h3>
                <button type="button" class="btn-location" onclick="getLocation()" id="locationBtn">
                    üìç –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
                </button>
                <div id="locationStatus" class="location-status status-info">
                    –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="firstName">–ò–º—è *</label>
                    <input type="text" id="firstName" th:field="*{firstName}" class="form-control"
                           th:value="${user.firstName}" required>
                    <span th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}" class="error-message"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" for="lastName">–§–∞–º–∏–ª–∏—è *</label>
                    <input type="text" id="lastName" th:field="*{lastName}" class="form-control"
                           th:value="${user.lastName}" required>
                    <span th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}" class="error-message"></span>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="dateOfBirth">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è *</label>
                <input type="date" id="dateOfBirth" th:field="*{dateOfBirth}" class="form-control"
                       th:value="${user.dateOfBirth}" required>
                <span th:if="${#fields.hasErrors('dateOfBirth')}" th:errors="*{dateOfBirth}" class="error-message"></span>
            </div>

            <div class="form-group">
                <label class="form-label" for="gender">–ü–æ–ª *</label>
                <select id="gender" th:field="*{gender}" class="form-control" required>
                    <option th:each="gender : ${genders}"
                            th:value="${gender}"
                            th:selected="${gender == user.gender}"
                            th:text="${gender.name()}">
                    </option>
                </select>
                <span th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}" class="error-message"></span>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label" for="country">–°—Ç—Ä–∞–Ω–∞ *</label>
                    <input type="text" id="country" th:field="*{country}" class="form-control"
                           th:value="${user.country}" required>
                    <span th:if="${#fields.hasErrors('country')}" th:errors="*{country}" class="error-message"></span>
                </div>

                <div class="form-group">
                    <label class="form-label" for="city">–ì–æ—Ä–æ–¥ *</label>
                    <input type="text" id="city" th:field="*{city}" class="form-control"
                           th:value="${user.city}" required>
                    <span th:if="${#fields.hasErrors('city')}" th:errors="*{city}" class="error-message"></span>
                </div>
            </div>

            <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
    </div>

    <!-- –¢–∞–± —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏ -->
    <div id="photos-tab" class="tab-content">
        <div class="upload-section">
            <h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é</h3>
            <form th:action="@{/profile/photos/upload}" method="post" enctype="multipart/form-data" class="upload-form">
                <input type="file" name="file" accept="image/*" class="file-input" required>
                <label class="checkbox-label">
                    <input type="checkbox" name="isPrimary"> –°–¥–µ–ª–∞—Ç—å –≥–ª–∞–≤–Ω–æ–π
                </label>
                <button type="submit" class="btn btn-primary">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </form>
        </div>

        <div th:if="${not #lists.isEmpty(userPhotos)}">
            <h3>–ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏</h3>
            <div class="photos-grid">
                <div th:each="photo : ${userPhotos}" class="photo-item">
                    <img th:src="@{/photos/{id}(id=${photo.id})}"
                         th:alt="User photo"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='">

                    <div th:if="${photo.isPrimary}" class="primary-badge">‚≠ê –ì–ª–∞–≤–Ω–∞—è</div>

                    <div class="photo-actions">
                        <a th:href="@{/profile/photos/{id}/primary(id=${photo.id})}"
                           th:unless="${photo.isPrimary}"
                           class="photo-action-btn">–ì–ª–∞–≤–Ω–∞—è</a>

                        <a th:href="@{/profile/photos/{id}/delete(id=${photo.id})}"
                           class="photo-action-btn"
                           onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é?')">–£–¥–∞–ª–∏—Ç—å</a>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${#lists.isEmpty(userPhotos)}" class="no-photos">
            <h3>üì∏ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h3>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ</p>
        </div>
    </div>
</div>

<script>
    function showTab(tabId) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ç–∞–±—ã
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.tab-button').forEach(button => {
            button.classList.remove('active');
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
        document.getElementById(tabId).classList.add('active');

        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
        event.target.classList.add('active');
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);

        if (urlParams.has('photo_success')) {
            alert('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
        }
        if (urlParams.has('primary_updated')) {
            alert('–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
        }
        if (urlParams.has('photo_deleted')) {
            alert('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞!');
        }
        if (urlParams.has('photo_error')) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π!');
        }
    });
</script>
</body>
</html>