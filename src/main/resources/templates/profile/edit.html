<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è - MatchApp</title>
    <link rel="stylesheet" th:href="@{/css/profile-edit.css}">
</head>
<body>
<div class="header">
    <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</h1>
</div>

<div th:if="${param.success}" class="alert alert-success">
    –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!
</div>

<div th:if="${param.error}" class="alert alert-error">
    –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è.
</div>

<div th:if="${error}" class="alert alert-error" th:text="${error}">
    –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö
</div>

<div class="edit-form">
    <h2 class="section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
    <form th:action="@{/profile/update}" th:object="${user}" method="post">
        <div class="form-row">
            <div class="form-column">
                <div class="form-group">
                    <label for="username" class="required">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                    <input type="text" id="username" th:field="*{username}" required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="email" class="required">Email</label>
                    <input type="email" id="email" th:field="*{email}" required
                           placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-column">
                <div class="form-group">
                    <label for="dateOfBirth" class="required">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                    <input type="date" id="dateOfBirth" name="dateOfBirth"
                           th:value="${user.dateOfBirth != null} ? ${#temporals.format(user.dateOfBirth, 'yyyy-MM-dd')} : ''"
                           placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è" required>
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="gender">–ü–æ–ª</label>
                    <select id="gender" th:field="*{gender}">
                        <option value="MALE">–ú—É–∂—Å–∫–æ–π</option>
                        <option value="FEMALE">–ñ–µ–Ω—Å–∫–∏–π</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-column">
                <div class="form-group">
                    <label for="country">–°—Ç—Ä–∞–Ω–∞</label>
                    <input type="text" id="country" th:field="*{country}" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É" required>
                </div>
            </div>
            <div class="form-column">
                <div class="form-group">
                    <label for="city">–ì–æ—Ä–æ–¥</label>
                    <input type="text" id="city" th:field="*{city}" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥" required>
                </div>
            </div>
        </div>

        <div class="form-group" style="text-align: center; margin-top: 30px;">
            <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <a href="/dashboard" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<div class="upload-section">
    <h2 class="section-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏</h2>

    <form th:action="@{/profile/photos/upload}" method="post" enctype="multipart/form-data" class="upload-form">
        <input type="file" name="photo" accept="image/*" class="file-input" required>
        <label class="checkbox-label">
            <input type="checkbox" name="isPrimary">
            –°–¥–µ–ª–∞—Ç—å –≥–ª–∞–≤–Ω–æ–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π
        </label>
        <button type="submit" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
    </form>
</div>

<div th:if="${not #lists.isEmpty(userPhotos)}">
    <h3>–ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ ([[${#lists.size(userPhotos)}]])</h3>
    <div class="photos-grid">
        <div th:each="photo : ${userPhotos}" class="photo-card">
            <div th:if="${photo.isPrimary}" class="primary-badge">‚≠ê –ì–ª–∞–≤–Ω–∞—è</div>
            <img th:src="@{/profile/photos/{id}(id=${photo.id})}"
                 th:alt="${photo.fileName}"
                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='">

            <div class="photo-info">
                <strong th:text="${photo.fileName}">photo.jpg</strong>
            </div>
            <div class="photo-info" th:if="${photo.fileSize}">
                –†–∞–∑–º–µ—Ä: <span th:text="${#numbers.formatDecimal(photo.fileSize / 1024, 1, 1)}">1024</span> KB
            </div>
            <div class="photo-info">
                –ó–∞–≥—Ä—É–∂–µ–Ω–æ: <span th:text="${#temporals.format(photo.uploadedAt, 'dd.MM.yyyy HH:mm')}">01.01.2024 12:00</span>
            </div>

            <div class="actions">
                <a th:href="@{/profile/photos/{id}/primary(id=${photo.id})}"
                   th:unless="${photo.isPrimary}"
                   class="btn btn-primary">–°–¥–µ–ª–∞—Ç—å –≥–ª–∞–≤–Ω–æ–π</a>

                <a th:href="@{/profile/photos/{id}/delete(id=${photo.id})}"
                   class="btn btn-danger"
                   onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é?')">–£–¥–∞–ª–∏—Ç—å</a>
            </div>
        </div>
    </div>
</div>

<div th:if="${#lists.isEmpty(userPhotos)}" class="no-photos">
    <h3>üì∏ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h3>
    <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –∏—Å–ø–æ–ª—å–∑—É—è —Ñ–æ—Ä–º—É –≤—ã—à–µ</p>
</div>

<div style="text-align: center; margin-top: 30px;">
    <a href="/dashboard" class="btn btn-primary">‚Üê –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
    <a href="/auth/logout" class="btn btn-secondary">–í—ã–π—Ç–∏</a>
</div>

<script th:if="${param.upload_success}">
    alert('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
</script>

<script th:if="${param.primary_updated}">
    alert('–ì–ª–∞–≤–Ω–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
</script>

<script th:if="${param.deleted}">
    alert('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è —É–¥–∞–ª–µ–Ω–∞!');
</script>

</body>
</html>